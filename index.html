<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ohio State Club Football Record Book</title>
  <meta name="description" content="Ohio State Club Football Record Book: team records, game-by-game results, awards, All-Americans, captains, and statistical leaders.">
  <link rel="preload" href="data.json" as="fetch" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1>Ohio State Club Football Record Book</h1>
      <p class="subtitle">Comprehensive records, results, and honors</p>
      <nav class="top-nav" aria-label="Sections">
        <a href="index.html">Home</a>
        <a href="team-records.html">Team Records</a>
        <a href="game-by-game.html">Game-by-Game</a>
        <a href="record-vs-opponents.html">Record vs. Opponents</a>
        <a href="awards.html">Awards</a>
        <a href="all-americans.html">All-Americans</a>
        <a href="stats.html">Stat Leaders</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section id="team-records" aria-labelledby="team-records-title">
      <h2 id="team-records-title">Team Records</h2>
      <div class="grid two">
        <article class="card">
          <h3>Year-by-Year Results</h3>
          <div class="table-wrap">
            <table>
              <thead>
                <tr><th>Year</th><th>Record</th><th>Note</th></tr>
              </thead>
              <tbody id="ybyTbody"></tbody>
            </table>
          </div>
        </article>
        <article class="card">
          <h3>Points (Game)</h3>
          <ol id="pointsGameList" class="rank-list"></ol>
          <p class="legend">Legend markers may denote league, playoff, or title game contexts.</p>
        </article>
        <article class="card">
          <h3>Points (Season)</h3>
          <ol id="pointsSeasonList" class="rank-list"></ol>
        </article>
        <article class="card">
          <h3>Points Per Game (Season)</h3>
          <ol id="ppgSeasonList" class="rank-list"></ol>
        </article>
        <article class="card">
          <h3>Wins/Record (Head Coach)</h3>
          <div class="table-wrap">
            <table>
              <thead>
                <tr><th>Coach</th><th>Record</th><th>Tenure</th></tr>
              </thead>
              <tbody id="coachesTbody"></tbody>
            </table>
          </div>
        </article>
      </div>
    </section>

    <section id="game-by-game" aria-labelledby="gbg-title">
      <h2 id="gbg-title">Game-by-Game Results</h2>
      <div id="gbgContainer" class="accordion"></div>
    </section>

    <section id="record-vs-opponents" aria-labelledby="rvo-title">
      <h2 id="rvo-title">Record vs. Opponents</h2>
      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>Opponent</th><th>W</th><th>L</th><th>First</th><th>Last</th></tr>
          </thead>
          <tbody id="rvoTbody"></tbody>
          <tfoot>
            <tr id="rvoOverallRow" class="muted"><td>Overall</td><td colspan="4" id="rvoOverallCell"></td></tr>
          </tfoot>
        </table>
      </div>
    </section>

    <section id="awards" aria-labelledby="awards-title">
      <h2 id="awards-title">NCFA National Awards</h2>
      <div id="awardsCards" class="grid three"></div>
    </section>

    <section id="all-americans" aria-labelledby="aa-title">
      <h2 id="aa-title">All-Americans</h2>
      <div class="grid three">
        <article class="card">
          <h3>First Team</h3>
          <div id="aaFirst"></div>
        </article>
        <article class="card">
          <h3>Second Team</h3>
          <div id="aaSecond"></div>
        </article>
        <article class="card">
          <h3>Honorable Mention</h3>
          <div id="aaHM"></div>
        </article>
      </div>
    </section>

    <section id="academic" aria-labelledby="academic-title">
      <h2 id="academic-title">NCFA Academic All-Americans</h2>
      <div id="academicList" class="year-groups"></div>
    </section>

    <section id="captains" aria-labelledby="captains-title">
      <h2 id="captains-title">Team Captains</h2>
      <div id="captainsList" class="year-groups"></div>
    </section>

    <section id="stats" aria-labelledby="stats-title">
      <h2 id="stats-title">Statistical Leaders</h2>
      <div class="grid two" id="statsGrid"></div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>Data source: `data.json`</p>
    </div>
  </footer>

  <script>
  const byTextSearch = (text, q) => {
    if (!q) return true;
    return (text || "").toLowerCase().includes(q.toLowerCase());
  };

  const safe = v => (v === null || v === undefined) ? "" : v;

  const makeListItem = (item) => {
    const li = document.createElement("li");
    const m = item.marker ? ` <span class="tag">${item.marker}</span>` : "";
    li.innerHTML = `<span class="rank">${item.rank}.</span> ${safe(item.text)}${m}`;
    return li;
  };

  const makeYearGroup = (year, entries, formatter) => {
    const wrap = document.createElement("div");
    wrap.className = "year-group";
    const h = document.createElement("h3");
    h.textContent = year;
    const ul = document.createElement("ul");
    entries.forEach(e => {
      const li = document.createElement("li");
      li.textContent = formatter ? formatter(e) : e;
      ul.appendChild(li);
    });
    wrap.append(h, ul);
    return wrap;
  };

  const parseGameRow = g => {
    // Fall back gracefully for malformed parsed items in the JSON
    const outcome = safe(g.outcome);
    const site = safe(g.site);
    const aTeam = safe(g.team_a);
    const aScore = g.score_a === null ? "" : g.score_a;
    const bTeam = safe(g.team_b);
    const bScore = g.score_b === null ? "" : g.score_b;
    const note = safe(g.note);
    const markers = Array.isArray(g.markers) ? g.markers.join("") : (g.markers || "");
    const raw = safe(g.raw);

    const left = aTeam && aScore !== "" ? `${aTeam} ${aScore}` : aTeam || "";
    const right = bTeam && bScore !== "" ? `${bTeam} ${bScore}` : bTeam || "";
    let matchup = "";
    if (left && right) {
      const sep = site === "neutral" ? "vs." : (site === "away" ? "@" : "@");
      matchup = `${left} ${sep} ${right}`;
    } else if (raw) {
      matchup = raw;
    } else {
      matchup = [left, right].filter(Boolean).join(" @ ");
    }

    return {
      outcome,
      site,
      matchup,
      note,
      markers
    };
  };

  const renderAllAmericans = (container, dict) => {
    container.innerHTML = "";
    Object.keys(dict).sort().forEach(year => {
      const entries = dict[year] || [];
      const ul = document.createElement("ul");
      ul.className = "compact";
      entries.forEach(e => {
        const name = safe(e.name);
        const pos = safe(e.position);
        const li = document.createElement("li");
        li.textContent = pos ? `${name} — ${pos}` : name;
        ul.appendChild(li);
      });
      const grp = document.createElement("div");
      grp.className = "year-group";
      const h = document.createElement("h3");
      h.textContent = year;
      grp.append(h, ul);
      container.appendChild(grp);
    });
  };

  const renderStatsBlock = (title, subcats) => {
    const card = document.createElement("article");
    card.className = "card";
    const h = document.createElement("h3");
    h.textContent = title;
    card.appendChild(h);
    Object.keys(subcats).forEach(sub => {
      const subH = document.createElement("h4");
      subH.textContent = sub;
      const ol = document.createElement("ol");
      ol.className = "rank-list compact";
      (subcats[sub] || []).forEach(item => ol.appendChild(makeListItem(item)));
      card.append(subH, ol);
    });
    return card;
  };

  const filterable = (root, input) => {
    const q = input.value.trim().toLowerCase();
    root.querySelectorAll("[data-search]").forEach(el => {
      const text = el.getAttribute("data-search") || el.textContent || "";
      el.style.display = text.toLowerCase().includes(q) ? "" : "none";
    });
  };

  async function init() {
    const res = await fetch("data.json");
    const data = await res.json();

    // No global search on Home

    // Year-by-year
    const ybyTbody = document.getElementById("ybyTbody");
    (data.team_records?.year_by_year || []).sort((a,b)=>b.year-a.year).forEach(r => {
      const tr = document.createElement("tr");
      tr.setAttribute("data-search", `${r.year} ${r.record||""} ${r.note||""}`);
      tr.innerHTML = `
        <td>${safe(r.year)}</td>
        <td>${safe(r.record)}</td>
        <td>${safe(r.note)}</td>
      `;
      ybyTbody.appendChild(tr);
    });

    // Ranked lists
    const pointsGameList = document.getElementById("pointsGameList");
    (data.team_records?.points_game || []).forEach(x => pointsGameList.appendChild(makeListItem(x)));

    const pointsSeasonList = document.getElementById("pointsSeasonList");
    (data.team_records?.points_season || []).forEach(x => pointsSeasonList.appendChild(makeListItem(x)));

    const ppgSeasonList = document.getElementById("ppgSeasonList");
    (data.team_records?.points_per_game_season || []).forEach(x => ppgSeasonList.appendChild(makeListItem(x)));

    // Coaches
    const coachesTbody = document.getElementById("coachesTbody");
    (data.team_records?.coach_records || []).forEach(c => {
      const tr = document.createElement("tr");
      tr.setAttribute("data-search", `${c.name} ${c.record} ${c.tenure}`);
      tr.innerHTML = `<td>${safe(c.name)}</td><td>${safe(c.record)}</td><td>${safe(c.tenure)}</td>`;
      coachesTbody.appendChild(tr);
    });

    // Game-by-game Accordion
    const gbgContainer = document.getElementById("gbgContainer");
    (data.game_by_game || []).forEach(season => {
      const details = document.createElement("details");
      details.className = "card";
      const summary = document.createElement("summary");
      summary.textContent = season.season_header || "Season";
      details.appendChild(summary);

      const tblWrap = document.createElement("div");
      tblWrap.className = "table-wrap";
      const table = document.createElement("table");
      table.innerHTML = `
        <thead>
          <tr><th>Result</th><th>Site</th><th>Matchup</th><th>Note</th><th>Markers</th></tr>
        </thead>
        <tbody></tbody>
      `;
      const tbody = table.querySelector("tbody");
      (season.games || []).forEach(g => {
        const row = parseGameRow(g);
        const tr = document.createElement("tr");
        tr.setAttribute("data-search", `${summary.textContent} ${row.matchup} ${row.note} ${row.markers}`);
        tr.innerHTML = `
          <td><span class="badge ${row.outcome === "W" ? "win" : row.outcome === "L" ? "loss" : "neutral"}">${safe(row.outcome)}</span></td>
          <td>${safe(row.site)}</td>
          <td>${safe(row.matchup)}</td>
          <td>${safe(row.note)}</td>
          <td>${safe(row.markers)}</td>
        `;
        tbody.appendChild(tr);
      });
      tblWrap.appendChild(table);
      details.appendChild(tblWrap);
      gbgContainer.appendChild(details);
    });

    // Record vs Opponents
    const rvoTbody = document.getElementById("rvoTbody");
    (data.record_vs_opponents?.rows || []).sort((a,b) => a.opponent.localeCompare(b.opponent)).forEach(r => {
      const tr = document.createElement("tr");
      tr.setAttribute("data-search", `${r.opponent} ${r.won}-${r.lost} ${r.first_meeting} ${r.last_meeting}`);
      tr.innerHTML = `
        <td>${safe(r.opponent)}</td>
        <td>${safe(r.won)}</td>
        <td>${safe(r.lost)}</td>
        <td>${safe(r.first_meeting)}</td>
        <td>${safe(r.last_meeting)}</td>
      `;
      rvoTbody.appendChild(tr);
    });
    const overall = data.record_vs_opponents?.overall;
    const overallCell = document.getElementById("rvoOverallCell");
    if (overall && (overall.won !== undefined)) {
      overallCell.textContent = `${overall.won}-${overall.lost}`;
    } else {
      document.getElementById("rvoOverallRow").style.display = "none";
    }

    // Awards
    const awardsCards = document.getElementById("awardsCards");
    (data.awards || []).forEach(a => {
      const card = document.createElement("article");
      card.className = "card award";
      card.setAttribute("data-search", `${a.title} ${a.role||""} ${a.person||""} ${a.narrative||""}`);
      card.innerHTML = `
        <h3>${safe(a.title)}</h3>
        <p class="muted">${[safe(a.role), safe(a.person)].filter(Boolean).join(" — ")}</p>
        <p>${safe(a.narrative)}</p>
      `;
      awardsCards.appendChild(card);
    });

    // All-Americans
    renderAllAmericans(document.getElementById("aaFirst"), data.all_americans?.first_team || {});
    renderAllAmericans(document.getElementById("aaSecond"), data.all_americans?.second_team || {});
    renderAllAmericans(document.getElementById("aaHM"), data.all_americans?.honorable_mention || {});

    // Academic All-Americans
    const academicList = document.getElementById("academicList");
    Object.keys(data.academic_all_americans || {}).sort().forEach(year => {
      const items = data.academic_all_americans[year] || [];
      const entries = items.map(x => x.position ? `${x.name} — ${x.position}` : x.name);
      academicList.appendChild(makeYearGroup(year, entries));
    });

    // Captains
    const captainsList = document.getElementById("captainsList");
    Object.keys(data.team_captains || {}).sort().forEach(year => {
      const items = data.team_captains[year] || [];
      const entries = items.map(x => x.position ? `${x.name} — ${x.position}` : x.name);
      captainsList.appendChild(makeYearGroup(year, entries));
    });

    // Stats
    const statsGrid = document.getElementById("statsGrid");
    const stats = data.stats || {};
    Object.keys(stats).forEach(block => {
      statsGrid.appendChild(renderStatsBlock(block.charAt(0).toUpperCase() + block.slice(1), stats[block]));
    });
  }

  init().catch(err => {
    console.error(err);
    document.body.insertAdjacentHTML("beforeend", `<pre class="error">Failed to load data. Ensure ohio_state_club_football_record_book.json is present.\n${err}</pre>`);
  });
  </script>
  <script src="script.js"></script>
</body>
</html>
